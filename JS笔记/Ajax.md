# Ajax

#### Ajax  叫   Asynchronous JavaScript  and  xml

1. 异步的作用：可以在用户不知不觉的状态下把网页上的数据更新掉

2. 异步：事件、定时器、ajax  都是异步。就是和其它的代码没有关联性

3. ```javascript
   function create(){
       var _xhr=new XMLHttpRequest();
       //open 方法的参数
       //1、method  GET/POST
       //2、 address（地址）  url
       //3、 async ： true（异步）  false（同步）
       _xhr.onreadystatechange=function(){};
       _xhr.open("POST","address","true");
       _xhr.send(null);
   }
   ```

4. ajax   readyState 状态值

   1. 执行open方法之前

#### 读取服务器数据

- 目前为止我们只有PHP可以拿到服务器上数据库里的数据.
- 我们的javascript拿不到服务器上的数据.
  - 因为JavaScript不安全,所以拿不到数据
  - 如何让JavaScript可以拿到服务器上的数据?

------

### Ajax

> 今天的所有内容都非常重要，这一章的内容是以后工作中，使用最多，而且也是最有价值的内容。前端工程师和后台工程师的数据传输，目前的主流方法还是Ajax。

- Ajax：即“Asynchronous Javascript And XML”（异步 JavaScript 和 XML），是指一种创建交互式网页应用的网页开发技术。

  > XML是一种数据格式，类似与HTML，在ajax发布的时候，xml是应用范围非常广发，包括目前，很多的应用程序的配置文件依然是XML文件。如java、c#、tomcat服务器的config文件等。但是由于浏览器的兼容性问题特别复杂，目前主流市场基本不对XML数据岛进行处理，取而代之的是JSON格式的数据，使用起来及其方便，而且简洁高效。所以只要知道AJAX中的X代表的是XML就行，无需花费精力在XML上。

- Ajax的优势：

  - 可以异步请求数据，一般情况下使用ajax的技术，基本都是异步，除非特殊情况下使用同步技术。
  - 效率高：因为Ajax可以实现网页中的部分内容改变，而其他整体无需改变。在ajax出现之前，或者不使用ajax技术的网页，想要更新一点点数据，都需要刷新整个网页。那么整个网页的数据都要冲服务器上重新再请求下来。
  - 有了ajax技术可以实现前后台分离，前端工程师只专注于前端开发，后端程序员只专注后端的开发。
  - 降低服务器端压力，有很多业务逻辑可以放到前端去解决，比如数据的重新合并。当然这些数据中不能包含敏感数据，如密码，银行卡等。也就是说需要保密的数据一般不在前端进行处理，这样会被不发分子查看源代码的时候获取到。同样在没有ajax技术的支持下，任何的业务逻辑只能在服务器端去实现，服务器端一行代码，假如同时有1万人访问呢，那么这样代码就会被执行1万次。但是如果用ajax技术实现的情况下，也就是每台电脑或手机执行一次而已。

- Ajax主要作用：就是向服务器端发送数据或者从服务器端请求数据到浏览器，简单说就是起到前后台数据传输作用。

- 在学习AJAX技术之前我们还需要了解一个叫**异步**的概念。非常简单，就是不同步执行的代码就叫异步，这是一个相对的概念，其实我们之前都有使用过，如事件，定时器等都是异步程序，他不依赖上下文的代码是否执行完毕，这样的程序就叫异步。

- 创建Ajax对象(解决IE兼容问题)

  ```
  function Ajax(){
      try{
          return new XMLHttpRequest();
      }catch(e){
          try{
              return new ActiveXObject("Microsoft.XMLHTTP");
          }catch(e){
              if(window.confirm("您的浏览器版本过时，是否下载新版浏览器？")){
              	window.location.href="http://www.baidu.com";
              }
          }
      }
      return null;
  }
  ```

- 建立链接

- 创建readyState监听

  - 0：调用open()方法之前.也就是刚创建好XMLHttpRequest对象
  - 1：表示调用open()方法。
  - 2：表示调用send()方法
  - 3：服务器响应过程中
  - 4：请求完成，服务器响应完成。

- 向服务器发送数据

------

### 回调函数

- 一般来讲通过指针调用的函数都叫回调函数，这是C语言的概念。
- js中指的是通过函数的形参调用的函数叫回调函数。

------

### GET&POST方式传参区别：

- GET方式传参，参数都会显示在浏览器地址栏中
- POST方式传参，参数的不会显示在地址栏中，相对比较安全
- 相对而言GET方式传递的参数长度相对较小（原因：地址栏的长度有限制。）
- GET&POST底层的数据传输方式是相同的。
- 在chrome浏览器中POST方式传输的数据和头部报文是分开的。但是在火狐中和头部报文一起被传输到服务器上的。

------

### AJAX配合PHP实现登录注册

------

### 事件委托

- 委托和代理相对概念：
- 事件委托的原理：利用事件冒泡机制实现
- 路由：作用地址分析，做数据分发。

------

### 前后台分离

- 前后台分离就是前端只专注于页面，后台只专注于后台的开发。
- 前端的工作内容：
  - 网页制作
  - 动画效果
  - 数据渲染
- 后台的工作内容：
  - 后台的程序设计
  - 后台的程序安全
  - 后台的数据优化
  - 服务器的搭建
  - API的规范定制

------

### 跨域：非同源策略下的数据访问或者叫交互，就得使用跨域技术。

- JSONP：和json之间没有任何关系，是一种跨域访问数据的方式
  - JSONP的原理：通过script标签src属性具有跨域的功能，来实现跨域的。
  - 服务器端返回值：必须是可执行的js代码
  - JSONP的跨域方式都是GET方式跨域
- CROSS：和ajax有关系，请求数据就是用ajax技术。这种跨域方式需要设置服务器。
- Agent代理：

------

### Promise

- 作用：解决异步嵌套的问题
- ES6中新增的对象，主要解决异步嵌套的问题。
- 异步嵌套
- Promise的状态
  - pendding: new Promise();
  - fulfilled: resolve();
  - rejected: 拒绝
    - 出现异常
    - 可以主动调用
- Promise的状态码一旦被修改就不能再回头了。
- Promise的语法
  - new Promise(function(){}).then(()=>{},()=>{});